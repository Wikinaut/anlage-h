<!DOCTYPE html>
<html lang="de">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>jQuery lokal ausführen</title>
    <script src="https://code.jquery.com/jquery-3.6.4.min.js"></script>
</head>
<body>

<h1>Anlage-H-Optimizer (Testdaten)</h1>
<div id="output"></div>

<script>

// initial 20250218
//

async function main() {

MAXDAYS=1460
LEAPDAY=1153
YEAR=365
LEAPYEAR=366

// adjust for 365/366 search windows
// wenn der aktuelle Beantragungszeitraum einen Schalttag umfasst,
// dann darf das nachfolgende Suchintervall erst nach 366 Tagen beginnen

function leapspan(jd) {
    if ( ( LEAPDAY < 0 ) || ( LEAPDAY > MAXDAYS ) ) {
        return YEAR
    }
    if ( ( jd >= LEAPDAY-YEAR ) && ( jd < LEAPDAY+1 ) ) {
        return LEAPYEAR
    } else {
        return YEAR
    }
}

// Erstellen der Listen valider Tupel T2 und Triplets T3
function* generatorT2() {
    for (let i = 0; i < MAXDAYS; i++) {
        for (j = i + leapspan(i); j <  MAXDAYS; j++) {
            yield [i, j]
        }
    }
}

function* generatorT3() {
    for (let i = 0; i < MAXDAYS; i++) {
        for (j = i + leapspan(i); j < MAXDAYS; j++) {
            for (k = j + leapspan(j); k < MAXDAYS; k++) {
                yield [i, j, k]  // Triplet erstellen
            }
        }
    }
}

async function print(string) {
    $('#output').append(string+"<br>")
    return new Promise(resolve => requestAnimationFrame(resolve));
}

async function printElement(el, string) {
    $(el).html(string)
    return new Promise(resolve => requestAnimationFrame(resolve));
}


async function rendernow() {
    // Warten, bis der Browser das nächste Frame rendert
    return new Promise(resolve => requestAnimationFrame(resolve));
}
    
async function bestimmeZweiOptimaleBeantragungszeiträume() {

    await print('Berechnung von zwei optimalen Intervallen startet.')

    // Initialisierung der maximalen Summe und maximalen Tupel-Index'
    max_sumT2 = -1
    max_tupel = []
    countT2 = 0
    
    // Berechnung der Summen und Bestimmung der maximalen Summe
    for ( let [t21, t22] of generatorT2() ) {
        countT2++
        sumT2 = Z[t21] + Z[t22]

        if ( sumT2 > max_sumT2 ) {
            max_sumT2 = sumT2
            max_tupel = [ t21, t22 ]
        }
    }

    print( "Zwei Intervalle: ["+max_tupel[0]+","+max_tupel[1]+"] => "+max_sumT2+" €" )
}


async function bestimmeDreiOptimaleBeantragungszeiträume() {

    await print('<br>Berechnung von drei optimalen Intervallen startet.<br><div id="maxsum"></div>')

    max_sumT3 = -1
    max_triplet = []
    countT3 = 0

    // Berechnung der Summen und Bestimmung der maximalen Summe
    for ( let [t31, t32, t33] of generatorT3() ) {
        countT3++
        sumT3 = Z[t31] + Z[t32] + Z[t33]

        if (sumT3 > max_sumT3) {
            max_sumT3 = sumT3
            // await print(max_sumT3)
            await printElement( "#maxsum", max_sumT3.toFixed(2) )
            max_triplet = [t31, t32, t33]
        }    
    }

    print( "Drei Intervalle: ["+max_triplet[0]+","+max_triplet[1]+","+max_triplet[2]+"] => "+max_sumT3+" €" )
    print( "Fertig.")
}

    /*** main ***/
    
    await print( "Lade Testdaten.")
    
    Z = testdata()
    await rendernow()
    
    var offset = 2459217;
    
    bestimmeZweiOptimaleBeantragungszeiträume()
    await rendernow();
    
    bestimmeDreiOptimaleBeantragungszeiträume()
    
} /* main */

main();


function testdata() {

/* Dummydaten */
// offset = 2459217; // 02.01.2021 - 31.12.2024

return [502.63,502.63,502.63,502.63,512.98,512.98,512.98,512.98,512.98,512.98,
512.98,512.98,512.98,512.98,512.98,512.98,512.98,512.98,512.98,512.98,
512.98,512.98,512.98,512.98,512.98,512.98,512.98,512.98,512.98,512.98,
512.98,512.98,512.98,512.98,512.98,512.98,512.98,512.98,512.98,512.98,
512.98,512.98,512.98,512.98,512.98,512.98,512.98,512.98,512.98,512.98,
512.98,513.91,513.91,513.91,513.91,513.91,513.91,513.91,533.29,534.19,
534.19,534.19,534.19,534.19,534.19,537.82,537.82,528.31,528.31,528.31,
512.17,512.17,512.17,502.66,513.16,513.16,508.14,508.14,508.14,508.14,
508.14,481.45,482.15,493.85,493.85,493.85,493.85,493.85,485.73,485.73,
485.73,485.73,485.73,485.73,485.73,484.73,484.73,484.73,484.73,484.73,
484.73,484.73,484.73,484.73,484.73,484.73,484.73,484.73,484.73,484.73,
484.73,484.73,484.73,484.73,484.73,559.42,559.42,559.42,559.42,559.42,
559.42,559.42,559.42,563.09,563.09,563.09,563.09,563.09,563.09,563.09,
563.09,563.09,563.09,563.09,563.09,563.09,584.06,580.36,580.36,580.36,
580.36,580.36,580.36,580.36,580.36,580.36,580.36,580.36,580.36,580.36,
580.36,554.38,554.38,554.38,554.38,554.38,554.38,545.77,545.77,545.77,
545.77,545.77,545.77,545.77,545.77,545.77,545.77,545.77,545.77,545.77,
551.71,536.42,561.53,541.28,541.28,541.28,541.28,544.86,544.86,544.86,
544.86,617.07,617.07,617.07,714.78,714.78,718.36,718.36,726.64,726.64,
726.64,726.64,726.64,726.64,726.64,726.64,726.64,726.64,726.64,712.90,
716.49,716.49,719.99,719.99,719.99,719.99,724.81,724.81,724.81,724.81,
724.81,724.81,724.81,724.81,724.81,724.81,724.81,724.81,724.81,724.81,
724.81,724.81,724.81,704.22,703.08,703.08,703.08,703.08,727.28,716.27,
716.27,716.27,716.27,716.27,716.27,735.35,891.35,891.35,891.35,891.35,
960.56,960.56,960.56,1077.56,1077.56,1077.56,1077.56,1194.56,1194.56,1194.56,
1194.56,1194.56,1193.99,1193.99,1310.99,1310.99,1310.99,1290.74,1270.85,1270.85,
1270.85,1387.85,1387.85,1357.64,1357.64,1357.64,1357.64,1357.64,1474.64,1474.64,
1474.64,1474.64,1474.64,1474.64,1474.64,1591.64,1591.64,1591.64,1591.64,1591.64,
1591.64,1591.64,1708.64,1708.64,1708.64,1708.64,1689.38,1689.38,1689.38,1806.38,
1806.38,1806.38,1806.38,1803.89,1803.89,1803.89,1803.89,1803.89,1803.89,1803.89,
1803.89,1803.89,1803.89,1920.89,1920.89,1920.89,1920.89,1920.89,1920.89,1920.89,
2037.89,2037.89,2091.89,2091.89,2130.89,2130.89,2130.89,2286.89,2290.00,2329.00,
2329.00,2368.00,2368.00,2368.00,2407.00,2407.00,2446.00,2500.00,2500.00,2500.00,
2500.00,2617.00,2652.37,2652.37,2652.37,2652.37,2652.37,2652.37,2717.38,2751.75,
2763.37,2763.00,2763.00,2769,2769,2770.19,2801.35,2801.35,2726.14,2731.18,
2731.18,2731.18,2731.18,2621.38,2728.78,2728.78,2728.78,2728.78,2728.78,2728.78,
2728.78,2728.78,2728.78,2728.78,2728.78,2728.78,2728.78,2732.34,2732.34,2721.99,
2757.26,2757.26,2757.26,2799.26,2799.26,2841.26,2841.26,2883.26,2883.26,2883.26,
2883.26,2883.26,2883.26,2925.26,2925.26,2925.26,2925.26,2967.26,2967.26,2967.26,
3130.04,3172.04,3172.04,3172.04,3179.84,3179.84,3179.84,3258.83,3258.83,3258.83,
3258.83,3258.83,3258.83,3258.83,3258.83,3258.83,3258.83,3258.83,3258.83,3258.83,
3312.83,3312.83,3312.83,3312.83,3312.83,3312.83,3353.90,3353.90,3353.90,3357.57,
3357.57,3357.57,3411.57,3392.19,3391.29,3391.29,3391.29,3391.29,3391.29,3391.29,
3387.67,3387.67,3387.67,3387.67,3387.67,3387.67,3387.67,3387.67,3387.67,3377.17,
3377.17,3377.17,3377.17,3377.17,3377.17,3377.17,3377.17,3376.47,3364.77,3364.77,
3364.77,3364.77,3364.77,3364.77,3406.77,3406.77,3406.77,3460.77,3460.77,3460.77,
3460.77,3460.77,3460.77,3460.77,3460.77,3460.77,3460.77,3460.77,3460.77,3460.77,
3460.77,3506.83,3506.83,3506.83,3506.83,3506.83,3506.83,3506.83,3548.83,3552.85,
3532.17,3536.07,3536.07,3536.07,3536.07,3536.07,3546.57,3600.57,3596.90,3638.90,
3638.90,3638.90,3638.90,3638.90,3638.90,3638.90,3638.90,3638.90,3638.90,3638.90,
3638.90,3677.81,3677.81,3779.81,3779.81,3779.81,3779.81,3779.81,3779.81,3779.81,
3779.81,3779.81,3779.81,3779.81,3779.81,3779.81,3779.81,3779.81,3779.81,3779.81,
3779.81,3953.81,3953.81,3953.81,3953.81,3953.81,3953.81,3953.81,3953.81,3953.81,
4007.81,4007.81,4007.81,4007.81,4007.81,4001.87,4026.44,4058.49,4058.49,4058.49,
4058.49,4062.56,4058.97,4076.85,4190.67,4190.67,4118.46,4118.46,4160.46,4062.75,
4062.75,4059.17,4059.17,4050.89,4050.89,4056.89,4056.89,4056.89,4056.89,4056.89,
4056.89,4056.89,4098.89,4128.15,4128.15,4124.56,4124.56,4121.07,4152.15,4152.15,
4194.15,4189.32,4208.46,4215.05,4224.62,4224.62,4279.91,4279.91,4279.91,4279.91,
4279.91,4279.91,4279.91,4279.91,4279.91,4279.91,4321.91,4321.91,4321.91,4321.91,
4321.91,4321.91,4321.91,4297.71,4297.71,4297.71,4297.71,4351.71,4351.71,4408.01,
4388.93,4232.93,4232.93,4232.93,4278.09,4208.88,4208.88,4208.88,4197.63,4197.63,
4197.63,4212,4099.15,4153.15,4153.15,4169.14,4169.14,4169.14,4169.14,4052.14,
4052.14,4052.14,4052.14,4052.14,4052.14,4052.14,3945.58,3945.58,3945.58,3945.58,
3945.58,3945.58,3945.58,3828.58,3828.58,3828.58,3828.58,3828.58,3828.58,3915.58,
3798.58,3849.58,3849.58,3849.58,3849.58,3849.58,3849.58,3732.58,3732.58,3732.58,
3732.58,3732.58,3732.58,3732.58,3615.58,3615.58,3615.58,3615.58,3615.58,3615.58,
3615.58,3615.58,3630.85,3651.34,3651.34,3651.34,3651.34,3651.34,3534.34,3534.34,
3635.05,3635.05,3635.05,3635.05,3635.05,3518.05,3518.05,3464.05,3464.05,3425.05,
3425.05,3425.05,3367.96,3466.74,3427.74,3427.74,3388.74,3388.74,3388.74,3349.74,
3403.74,3490.74,3436.74,3436.74,3436.74,3436.74,3319.74,3287.65,3329.65,3329.65,
3337.76,3337.76,3463.76,3402.66,3536.28,3505.29,3502.07,3502.07,3495.83,3495.83,
3494.88,3517.72,3517.72,3517.72,3512.68,3512.68,3512.68,3512.68,3506.98,3399.58,
3399.58,3399.58,3399.58,3399.58,3399.58,3399.58,3399.58,3399.58,3399.58,3399.58,
3399.58,3422.86,3419.30,3419.30,3419.30,3384.03,3384.03,3384.03,3342.03,3342.03,
3300.03,3300.03,3258.03,3258.03,3258.03,3258.03,3258.03,3258.03,3216.03,3216.03,
3216.03,3216.03,3174.03,3174.03,3174.03,3011.25,2969.25,2969.25,2992.52,2984.72,
2984.72,2984.72,2905.73,2905.73,2905.73,2905.73,2905.73,2905.73,2950.73,2950.73,
2950.73,2950.73,2967.62,2967.62,2967.62,2913.62,2913.62,2913.62,2913.62,2913.62,
2913.62,2871.62,2871.62,2871.62,2867.95,2867.95,2925.62,2875.53,2875.53,2875.53,
2875.53,2875.53,2875.53,2875.53,2875.53,2875.53,2875.53,2875.53,2875.53,2875.53,
2875.53,2875.53,2875.53,2875.53,2875.53,2875.53,2875.53,2875.53,2875.53,2890.02,
2890.02,2890.02,2890.02,2914.14,2914.14,2914.14,2914.14,2914.14,2914.14,2872.14,
2872.14,2872.14,2842.23,2842.23,2842.23,2842.23,2842.23,2842.23,2842.23,2842.23,
2842.23,2842.23,2842.23,2842.23,2845.40,2845.40,2799.34,2799.34,2799.34,2803.43,
2803.43,2803.43,2803.43,2786.60,2798.39,2744.39,2740.48,2740.48,2794.48,2794.48,
2794.48,2783.98,2729.98,2729.98,2687.98,2687.98,2687.98,2687.98,2687.98,2687.98,
2687.98,2687.98,2687.98,2687.98,2751.37,2751.37,2691.49,2691.49,2589.49,2589.49,
2589.49,2589.49,2589.49,2589.49,2589.49,2589.49,2589.49,2621.59,2621.59,2621.59,
2621.59,2621.59,2621.59,2621.59,2621.59,2621.59,2447.59,2447.59,2447.59,2447.59,
2548.30,2548.30,2548.30,2548.30,2548.30,2494.30,2494.30,2498.29,2498.29,2498.29,
2688.43,2827.66,2770.51,2770.51,2770.51,2770.51,2766.44,2768.21,2750.90,2637.08,
2637.08,2686.63,2740.63,2698.63,2869.63,2870.22,2870.22,2870.22,2924.22,2969.22,
3008.22,3008.22,3008.22,3013.92,3013.92,3058.92,3058.92,3061.92,3033.53,3078.53,
3078.53,3078.53,3123.53,3137.45,3137.45,3140.45,3140.45,3121.31,3114.72,3105.15,
3150.15,3094.86,3149.73,3194.73,3194.73,3194.73,3248.73,3248.73,3248.73,3293.73,
3338.73,3296.73,3296.73,3365.81,3391.58,3445.58,3445.58,3490.58,3490.58,3490.58,
3544.58,3589.58,3536.39,3536.39,3525.09,3530.07,3530.07,3530.07,3530.07,3484.90,
3493.60,3493.60,3493.60,3387.85,3432.85,3432.85,3419.11,3415.20,3361.20,3361.20,
3345.21,3345.21,3345.21,3347.90,3347.90,3347.90,3347.90,3347.90,3347.90,3347.90,
3347.90,3337.46,3353.83,3353.83,3353.83,3354.58,3354.58,3354.58,3354.58,3354.58,
3354.58,3354.58,3480.58,3480.58,3393.58,3393.58,3342.58,3342.58,3342.58,3342.58,
3342.58,3342.58,3342.58,3342.58,3342.58,3342.58,3468.58,3468.58,3724.78,3724.78,
3724.78,3724.78,3724.78,3724.78,3724.78,3724.78,3724.78,3709.51,3689.02,3689.02,
3815.02,3815.02,3948.52,3948.52,3948.52,3847.81,3847.81,3847.81,3847.81,3847.81,
3847.81,3847.81,3847.81,3847.81,3847.81,3847.81,3847.81,3748.90,3647.02,3647.02,
3647.02,3710.41,3710.41,3714.45,3714.45,3660.45,3534.45,3534.45,3534.45,3534.45,
3667.95,3667.95,3664.66,3622.66,3622.66,3614.56,3614.56,3488.56,3484.65,3316.65,
3316.65,3316.65,3316.65,3316.65,3316.65,3316.65,3262.65,3262.65,3262.65,3388.65,
3388.65,3522.15,3522.15,3522.15,3522.15,3522.15,3522.15,3522.15,3522.15,3522.15,
3522.15,3522.15,3522.15,3522.15,3522.15,3522.15,3498.87,3516.18,3516.18,3516.18,
3516.18,3516.18,3516.18,3516.18,3516.18,3516.18,3516.18,3516.18,3516.18,3516.18,
3516.18,3516.18,3516.18,3516.18,3516.18,3516.18,3516.18,3516.18,3516.18,3516.18,
3516.18,3516.18,3516.18,3492.91,3492.91,3492.91,3492.91,3492.91,3492.91,3492.91,
3492.91,3492.91,3492.91,3447.91,3447.91,3447.91,3447.91,3431.02,3431.02,3431.02,
3431.02,3431.02,3431.02,3431.02,3431.02,3431.02,3431.02,3431.02,3431.02,3431.02,
3431.02,3373.34,3369.43,3369.43,3369.43,3369.43,3369.43,3369.43,3369.43,3369.43,
3369.43,3369.43,3369.43,3369.43,3369.43,3369.43,3369.43,3369.43,3369.43,3369.43,
3369.43,3369.43,3369.43,3369.43,3369.43,3354.94,3354.94,3354.94,3354.94,3330.82,
3330.82,3330.82,3330.82,3330.82,3330.82,3330.82,3330.82,3330.82,3306.73,3306.73,
3306.73,3306.73,3306.73,3306.73,3306.73,3306.73,3306.73,3306.73,3306.73,3306.73,
3303.56,3303.56,3303.56,3303.56,3303.56,3299.48,3299.48,3299.48,3299.48,3274.31,
3258.50,3258.50,3258.50,3258.50,3204.50,3204.50,3204.50,3204.50,3204.50,3204.50,
3204.50,3204.50,3204.50,3204.50,3204.50,3204.50,3204.50,3204.50,3204.50,3204.50,
3141.11,3141.11,3141.11,3141.11,3141.11,3141.11,3141.11,3141.11,3141.11,3141.11,
3141.11,3141.11,3141.11,3109.01,3109.01,3109.01,3109.01,3109.01,3109.01,3109.01,
3109.01,3109.01,3109.01,3109.01,3109.01,3109.01,3008.30,3008.30,3008.30,3008.30,
3008.30,3008.30,3008.30,3004.31,3004.31,3004.31,2814.17,2650.37,2650.37,2650.37,
2650.37,2650.37,2650.37,2648.60,2648.03,2648.03,2648.03,2598.48,2544.48,2544.48,
2373.48,2372.89,2372.89,2372.89,2318.89,2273.89,2228.89,2228.89,2228.89,2223.20,
2223.20,2178.20,2178.20,2133.20,2132.32,2087.32,2087.32,2087.32,2042.33,1997.33,
1997.33,1952.33,1952.33,1952.33,1952.33,1952.33,1907.33,1907.33,1852.45,1807.45,
1807.45,1807.45,1753.45,1753.45,1753.45,1708.45,1663.45,1663.45,1663.45,1594.37,
1568.60,1514.60,1514.60,1469.60,1469.60,1469.60,1415.60,1370.60,1369.80,1369.80,
1324.80,1319.82,1319.82,1319.82,1319.82,1319.82,1311.12,1311.12,1311.12,1311.12,
1266.12,1266.12,1265.25,1265.25,1265.25,1265.25,1265.25,1265.25,1265.25,1262.56,
1262.56,1262.56,1262.56,1262.56,1262.56,1262.56,1262.56,1262.56,1246.19,1246.19,
1246.19,1245.44,1245.44,1245.44,1245.44,1245.44,1245.44,1245.44,1119.44,1119.44,
1119.44,1119.44,1119.44,1119.44,1119.44,1119.44,1119.44,1119.44,1119.44,1119.44,
1119.44,1119.44,993.44,993.44,737,737,737,737,737,737,
737,737,737,737,737,737,611,611,477.74,477.74,
477.74,477.74,477.74,477.74,477.74,477.74,477.74,477.74,477.74,477.74,
477.74,477.74,477.74,477.74,477.74,477.74,477.74,414.35,414.35,410.31,
410.31,410.31,410.31,410.31,410.31,410.31,276.81,276.81,276.81,276.81,
276.81,276.81,276.81,276.81,276.81,276.81,276.81,276.81,276.81,276.81,
276.81,276.81,276.81,276.81,276.81,150.81,150.81,17.31,17.31,17.31,
17.31,17.31,17.31,17.31,17.31,17.31,17.31,17.31,17.31,17.31]; }

</script>

</body>
</html>
